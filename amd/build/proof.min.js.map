{"version":3,"file":"proof.min.js","sources":["../src/proof.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n\n/**\n *\n * @package\n * @copyright  2025 Brian A. Pool\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    return {\n        init: function(mooproofid, maxwords, chatmessagelimit) {\n\n            var currentTab = 'paste';\n            var fileContent = null;\n            var fileName = null;\n            // Chat variables\n            var currentPaper = null;\n            var currentFeedback = null;\n            var chatHistory = [];\n            var chatMessageCount = 0;\n\n            // Tab switching\n            $('.mooproof-tab').on('click', function() {\n                var tab = $(this).data('tab');\n\n                // Update active tab\n                $('.mooproof-tab').removeClass('active');\n                $(this).addClass('active');\n\n                // Show corresponding content\n                $('.mooproof-tab-content').removeClass('active');\n                $('#' + tab + '-tab').addClass('active');\n\n                currentTab = tab;\n            });\n\n            // Word count for paste tab\n            $('#mooproof-text-input').on('input', function() {\n                var text = $(this).val();\n                var words = text.trim().split(/\\s+/).filter(function(word) {\n                    return word.length > 0;\n                }).length;\n\n                $('#word-count').text(words);\n\n                if (maxwords > 0 && words > maxwords) {\n                    $('#word-count').css('color', 'red');\n                } else {\n                    $('#word-count').css('color', '#333');\n                }\n            });\n\n            // File selection\n            $('#select-file-btn').on('click', function() {\n                $('#file-input').click();\n            });\n\n            $('#file-input').on('change', function() {\n                var file = this.files[0];\n                if (file) {\n                    // Check file extension\n                    var ext = file.name.split('.').pop().toLowerCase();\n                    if (ext !== 'txt' && ext !== 'docx') {\n                        Str.get_string('unsupportedfiletype', 'mooproof').done(function(str) {\n                            alert(str);\n                        });\n                        $(this).val(''); // Clear the input\n                        $('#mooproof-file-name').html('');\n                        return;\n                    }\n\n                    fileName = file.name;\n                    Str.get_string('selected', 'mooproof').done(function(str) {\n                        $('#mooproof-file-name').html('<strong>' + str + '</strong> ' + fileName);\n                    });\n\n                    // Read file content\n                    var reader = new FileReader();\n                    reader.onload = function(e) {\n                        var content = e.target.result;\n\n                        if (ext === 'txt') {\n                            // Plain text - use as is\n                            fileContent = content;\n                        } else if (ext === 'docx') {\n                            // DOCX - send as base64\n                            fileContent = content.split(',')[1]; // Remove data:... prefix\n                            Str.get_string('fileuploadedextract', 'mooproof').done(function(str) {\n                                $('#mooproof-file-name').append('<br><em>' + str + '</em>');\n                            });\n                        }\n                    };\n\n                    // Read file appropriately\n                    if (ext === 'txt') {\n                        reader.readAsText(file);\n                    } else {\n                        reader.readAsDataURL(file);\n                    }\n                }\n            });\n\n            // Submit for proofing\n            $('#mooproof-submit').on('click', function() {\n                var papertext = '';\n                var filename = '';\n\n                if (currentTab === 'paste') {\n                    papertext = $('#mooproof-text-input').val().trim();\n                    if (papertext === '') {\n                        Str.get_strings([\n                            {key: 'error', component: 'mooproof'},\n                            {key: 'pleaseentertext', component: 'mooproof'}\n                        ]).done(function(strings) {\n                            Notification.alert(strings[0], strings[1]);\n                        });\n                        return;\n                    }\n                } else {\n                    if (!fileContent) {\n                        Str.get_strings([\n                            {key: 'error', component: 'mooproof'},\n                            {key: 'pleaseselectfile', component: 'mooproof'}\n                        ]).done(function(strings) {\n                            Notification.alert(strings[0], strings[1]);\n                        });\n                        return;\n                    }\n                    papertext = fileContent;\n                    filename = fileName;\n                }\n\n                // Check word count\n                var wordCount = papertext.trim().split(/\\s+/).filter(function(word) {\n                    return word.length > 0;\n                }).length;\n\n                if (maxwords > 0 && wordCount > maxwords) {\n                    Str.get_strings([\n                        {key: 'wordlimitexceededtitle', component: 'mooproof'},\n                        {key: 'wordlimitexceeded', component: 'mooproof'}\n                    ]).done(function(strings) {\n                        var message = strings[1].replace('{$a->count}', wordCount).replace('{$a->max}', maxwords);\n                        Notification.alert(strings[0], message);\n                    });\n                    return;\n                }\n\n                // Disable submit button and show loading\n                $('#mooproof-submit').prop('disabled', true);\n                $('#mooproof-loading-indicator').show();\n                $('.mooproof-input-section').hide();\n\n                // Call API using Moodle's Ajax API\n                Ajax.call([{\n                    methodname: 'mod_mooproof_submit_paper',\n                    args: {\n                        mooproofid: mooproofid,\n                        papertext: papertext,\n                        filename: filename\n                    }\n                }])[0].done(function(response) {\n                    $('#mooproof-loading-indicator').hide();\n\n                    if (!response.success || response.error) {\n                        Str.get_string('error', 'mooproof').done(function(str) {\n                            Notification.alert(str, response.error);\n                        });\n                        $('.mooproof-input-section').show();\n\n                        // Check if rate limit reached\n                        if (response.remaining === 0) {\n                            $('#mooproof-submit').prop('disabled', true);\n                        } else {\n                            $('#mooproof-submit').prop('disabled', false);\n                        }\n\n                        // Update the submissions remaining display\n                        updateRemainingDisplay(response.remaining);\n                    } else if (response.success && response.feedback) {\n                        // Store paper and feedback for chat\n                        currentPaper = papertext;\n                        currentFeedback = response.feedback;\n                        chatHistory = [];\n                        chatMessageCount = 0;\n\n                        // Display results\n                        var formattedFeedback = formatFeedback(response.feedback);\n                        $('#proofing-results').html(formattedFeedback);\n                        $('#results-section').show();\n\n                        // Show chat section\n                        $('#chat-section').show();\n                        $('#chat-messages').html('');\n                        $('#chat-input').val('').prop('disabled', false);\n                        $('#chat-send').prop('disabled', false);\n                        updateChatRemaining();\n\n                        // Update the submissions remaining display\n                        updateRemainingDisplay(response.remaining);\n                    }\n                }).fail(function() {\n                    $('#mooproof-loading-indicator').hide();\n                    Str.get_strings([\n                        {key: 'error', component: 'mooproof'},\n                        {key: 'failedconnectproofing', component: 'mooproof'}\n                    ]).done(function(strings) {\n                        Notification.alert(strings[0], strings[1]);\n                    });\n                    $('.mooproof-input-section').show();\n                    $('#mooproof-submit').prop('disabled', false);\n                });\n            });\n\n            // Update remaining display\n            var updateRemainingDisplay = function(remaining) {\n                if (remaining >= 0) {\n                    Str.get_string('submissionsremaining', 'mooproof', remaining).done(function(str) {\n                        var alertDivs = $('#results-section .alert-info').filter(function() {\n                            return $(this).text().toLowerCase().indexOf('submission') !== -1;\n                        });\n\n                        if (alertDivs.length > 0) {\n                            alertDivs.first().html('<strong>' + str + '</strong>');\n                        }\n                    });\n                }\n            };\n\n            // Reset button\n            $('#mooproof-reset').on('click', function() {\n                $('#results-section').hide();\n                $('#chat-section').hide();\n                $('.mooproof-input-section').show();\n\n                // Clear inputs\n                $('#mooproof-text-input').val('');\n                $('#word-count').text('0');\n                fileContent = null;\n                $('#mooproof-file-name').html('');\n                $('#file-input').val('');\n\n                // Reset to paste tab\n                $('.mooproof-tab').removeClass('active');\n                $('.mooproof-tab[data-tab=\"paste\"]').addClass('active');\n                $('.mooproof-tab-content').removeClass('active');\n                $('#paste-tab').addClass('active');\n                currentTab = 'paste';\n\n                // Re-enable submit button if there are submissions remaining\n                if ($('#results-section .alert-info:contains(\"Submissions remaining: 0\")').length === 0 &&\n                    $('#results-section .alert-info:contains(\"0\")').length === 0) {\n                    $('#mooproof-submit').prop('disabled', false);\n                }\n            });\n\n            // Format feedback with proper HTML\n            var formatFeedback = function(text) {\n                // Escape HTML first\n                var escaped = escapeHtml(text);\n\n                // Handle markdown bold\n                escaped = escaped.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\n                escaped = escaped.replace(/__([^_]+)__/g, '<strong>$1</strong>');\n\n                // Handle markdown italic\n                escaped = escaped.replace(/\\*([^*\\n]+)\\*/g, '<em>$1</em>');\n\n                // Convert double line breaks to paragraphs\n                escaped = escaped.replace(/\\n\\n+/g, '</p><p>');\n\n                // Convert single line breaks to <br>\n                escaped = escaped.replace(/\\n/g, '<br>');\n\n                // Wrap in paragraph tags\n                escaped = '<p>' + escaped + '</p>';\n\n                // Handle numbered lists\n                escaped = escaped.replace(/(\\d+)\\.\\s/g, '<br><strong>$1.</strong> ');\n\n                // Handle bullet points\n                escaped = escaped.replace(/<br>[-*]\\s+/g, '<br>• ');\n                escaped = escaped.replace(/<p>[-*]\\s+/g, '<p>• ');\n\n                return escaped;\n            };\n\n            // Escape HTML\n            var escapeHtml = function(text) {\n                var div = document.createElement('div');\n                div.textContent = text;\n                return div.innerHTML;\n            };\n\n            // Chat send button\n            $('#chat-send').on('click', function() {\n                sendChatMessage();\n            });\n\n            // Chat input enter key\n            $('#chat-input').on('keypress', function(e) {\n                if (e.which === 13 && !e.shiftKey) {\n                    e.preventDefault();\n                    sendChatMessage();\n                }\n            });\n\n            // Send chat message function\n            var sendChatMessage = function() {\n                var message = $('#chat-input').val().trim();\n\n                if (message === '' || !currentPaper || !currentFeedback) {\n                    return;\n                }\n\n                // Check message limit\n                if (chatMessageCount >= chatmessagelimit) {\n                    Str.get_strings([\n                        {key: 'limitreached', component: 'mooproof'},\n                        {key: 'maxquestionsreached', component: 'mooproof'}\n                    ]).done(function(strings) {\n                        Notification.alert(strings[0], strings[1]);\n                    });\n                    return;\n                }\n\n                // Disable input while processing\n                $('#chat-input').prop('disabled', true);\n                $('#chat-send').prop('disabled', true);\n\n                // Add user message to display\n                addChatMessage('user', message);\n\n                // Add to history\n                chatHistory.push({\n                    role: 'user',\n                    content: message\n                });\n\n                chatMessageCount++;\n\n                // Clear input\n                $('#chat-input').val('');\n\n                // Show thinking indicator\n                var thinkingId = 'chat-thinking-' + Date.now();\n                Str.get_string('thinking', 'mooproof').done(function(str) {\n                    $('#chat-messages').append(\n                        '<div class=\"mooproof-chat-message mooproof-chat-assistant\" id=\"' + thinkingId + '\">' +\n                        '<em>' + str + '</em></div>'\n                    );\n                    scrollChatToBottom();\n                });\n\n                // Call chat API using Moodle's Ajax API\n                Ajax.call([{\n                    methodname: 'mod_mooproof_send_chat_message',\n                    args: {\n                        mooproofid: mooproofid,\n                        message: message,\n                        papertext: currentPaper,\n                        feedback: currentFeedback,\n                        chathistory: JSON.stringify(chatHistory)\n                    }\n                }])[0].done(function(response) {\n                    // Remove thinking indicator\n                    $('#' + thinkingId).remove();\n\n                    if (!response.success || response.error) {\n                        Str.get_string('error', 'mooproof').done(function(str) {\n                            Notification.alert(str, response.error);\n                        });\n                        if (response.remaining === 0) {\n                            $('#chat-input').prop('disabled', true);\n                            $('#chat-send').prop('disabled', true);\n                        }\n                    } else if (response.success && response.reply) {\n                        // Add assistant reply\n                        addChatMessage('assistant', response.reply);\n\n                        // Add to history\n                        chatHistory.push({\n                            role: 'assistant',\n                            content: response.reply\n                        });\n\n                        // Update remaining count\n                        updateChatRemaining();\n                    }\n\n                    // Re-enable input (unless disabled by limit)\n                    if (chatMessageCount < chatmessagelimit) {\n                        $('#chat-input').prop('disabled', false);\n                        $('#chat-send').prop('disabled', false);\n                        $('#chat-input').focus();\n                    } else {\n                        $('#chat-input').prop('disabled', true);\n                        $('#chat-send').prop('disabled', true);\n                    }\n                }).fail(function() {\n                    $('#' + thinkingId).remove();\n                    Str.get_strings([\n                        {key: 'error', component: 'mooproof'},\n                        {key: 'failedconnectchat', component: 'mooproof'}\n                    ]).done(function(strings) {\n                        Notification.alert(strings[0], strings[1]);\n                    });\n                    $('#chat-input').prop('disabled', false);\n                    $('#chat-send').prop('disabled', false);\n                });\n            };\n\n            // Add message to chat display\n            var addChatMessage = function(role, content) {\n                var messageClass = role === 'user' ? 'mooproof-chat-user' : 'mooproof-chat-assistant';\n                var formattedContent = formatFeedback(content);\n                var messageHtml = '<div class=\"mooproof-chat-message ' + messageClass + '\">' +\n                                 formattedContent + '</div>';\n                $('#chat-messages').append(messageHtml);\n                scrollChatToBottom();\n            };\n\n            // Update chat remaining count\n            var updateChatRemaining = function() {\n                var remaining = chatmessagelimit - chatMessageCount;\n                Str.get_string('questionsremaining', 'mooproof', remaining).done(function(str) {\n                    $('#chat-remaining').text(str);\n                });\n            };\n\n            // Scroll chat to bottom\n            var scrollChatToBottom = function() {\n                var chatMessages = $('#chat-messages');\n                chatMessages.scrollTop(chatMessages[0].scrollHeight);\n            };\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","mooproofid","maxwords","chatmessagelimit","currentTab","fileContent","fileName","currentPaper","currentFeedback","chatHistory","chatMessageCount","on","tab","this","data","removeClass","addClass","words","val","trim","split","filter","word","length","text","css","click","file","files","ext","name","pop","toLowerCase","get_string","done","str","alert","html","reader","FileReader","onload","e","content","target","result","append","readAsText","readAsDataURL","papertext","filename","get_strings","key","component","strings","wordCount","message","replace","prop","show","hide","call","methodname","args","response","success","error","remaining","updateRemainingDisplay","feedback","formattedFeedback","formatFeedback","updateChatRemaining","fail","alertDivs","indexOf","first","escaped","escapeHtml","div","document","createElement","textContent","innerHTML","sendChatMessage","which","shiftKey","preventDefault","addChatMessage","push","role","thinkingId","Date","now","scrollChatToBottom","chathistory","JSON","stringify","remove","reply","focus","messageHtml","chatMessages","scrollTop","scrollHeight"],"mappings":"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"}